---
/**
 * Feature Card
 * Click to open modal overlay with details
 * Special features (like Command Palette) redirect to dedicated pages
 */
import type { Feature } from "../data/features";
import { categories } from "../data/features";

interface Props {
  feature: Feature;
}

const { feature } = Astro.props;
const category = categories[feature.category];
const BASE_URL = import.meta.env.BASE_URL;

// Features with dedicated pages
const dedicatedPages: Record<string, string> = {
  "command-palette": `${BASE_URL}/features/command-palette/`,
};

const dedicatedPage = dedicatedPages[feature.id];
const hasDetails = feature.longDescription || feature.tips || dedicatedPage;
---

<div
  class="feature-card card group cursor-pointer hover:border-accent-300 dark:hover:border-accent-600 transition-colors"
  id={`feature-${feature.id}`}
  data-feature-id={feature.id}
  data-feature-title={feature.title}
  data-feature-description={feature.description}
  data-feature-icon={feature.icon}
  data-feature-category={category.name}
  data-feature-category-icon={category.icon}
  data-feature-tags={JSON.stringify(feature.tags)}
  data-feature-long-description={feature.longDescription || ""}
  data-feature-tips={JSON.stringify(feature.tips || [])}
  data-feature-dedicated-page={dedicatedPage || ""}
>
  <div class="flex items-start gap-4">
    <!-- Icon -->
    <div
      class="text-3xl flex-shrink-0 group-hover:scale-110 transition-transform"
    >
      {feature.icon}
    </div>

    <!-- Content -->
    <div class="flex-1 min-w-0">
      <div class="flex items-center gap-2 mb-2 flex-wrap">
        <h3 class="font-semibold text-lg text-gray-900 dark:text-white">
          {feature.title}
        </h3>
        {
          feature.highlight && (
            <span class="px-2 py-0.5 text-xs font-medium bg-accent-500/10 text-accent-600 dark:text-accent-400 rounded-full">
              Popular
            </span>
          )
        }
        {
          dedicatedPage && (
            <span class="px-2 py-0.5 text-xs font-medium bg-blue-500/10 text-blue-600 dark:text-blue-400 rounded-full">
              View Page â†’
            </span>
          )
        }
      </div>

      <p class="text-gray-600 dark:text-gray-400 text-sm mb-3 line-clamp-2">
        {feature.description}
      </p>

      <!-- Footer -->
      <div class="flex items-center justify-between gap-2">
        <span
          class="inline-flex items-center gap-1 text-xs font-medium text-gray-500 dark:text-gray-400"
        >
          <span>{category.icon}</span>
          {category.name}
        </span>

        {
          hasDetails && (
            <span class="text-xs text-accent-500 font-medium inline-flex items-center gap-1">
              {dedicatedPage ? "Learn more" : "Click for details"}
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                />
              </svg>
            </span>
          )
        }
      </div>
    </div>
  </div>
</div>

<script>
  function initFeatureCards() {
    document.querySelectorAll(".feature-card").forEach((card) => {
      card.addEventListener("click", () => {
        const data = {
          id: card.getAttribute("data-feature-id") || "",
          title: card.getAttribute("data-feature-title") || "",
          description: card.getAttribute("data-feature-description") || "",
          icon: card.getAttribute("data-feature-icon") || "",
          category: card.getAttribute("data-feature-category") || "",
          categoryIcon: card.getAttribute("data-feature-category-icon") || "",
          tags: JSON.parse(card.getAttribute("data-feature-tags") || "[]"),
          longDescription:
            card.getAttribute("data-feature-long-description") || undefined,
          tips: JSON.parse(card.getAttribute("data-feature-tips") || "[]"),
          dedicatedPage:
            card.getAttribute("data-feature-dedicated-page") || undefined,
        };

        // Filter empty values
        if (!data.longDescription) data.longDescription = undefined;
        if (data.tips.length === 0) data.tips = undefined;
        if (!data.dedicatedPage) data.dedicatedPage = undefined;

        // Open modal (or redirect to dedicated page)
        if ((window as any).__openFeatureModal) {
          (window as any).__openFeatureModal(data);
        }
      });
    });
  }

  document.addEventListener("astro:page-load", initFeatureCards);
  initFeatureCards();
</script>
