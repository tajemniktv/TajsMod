---
/**
 * Expandable Feature Card
 * Click to expand/collapse for more details
 */
import type { Feature } from "../data/features";
import { categories } from "../data/features";

interface Props {
  feature: Feature;
}

const { feature } = Astro.props;
const category = categories[feature.category];
const hasDetails = feature.longDescription || feature.tips;
---

<div
  class="feature-card card group"
  id={`feature-${feature.id}`}
  data-expandable={hasDetails ? "true" : "false"}
>
  <div class="flex items-start gap-4">
    <!-- Icon -->
    <div
      class="text-3xl flex-shrink-0 group-hover:scale-110 transition-transform"
    >
      {feature.icon}
    </div>

    <!-- Content -->
    <div class="flex-1 min-w-0">
      <div class="flex items-center gap-2 mb-2 flex-wrap">
        <h3 class="font-semibold text-lg text-gray-900 dark:text-white">
          {feature.title}
        </h3>
        {
          feature.highlight && (
            <span class="px-2 py-0.5 text-xs font-medium bg-accent-500/10 text-accent-600 dark:text-accent-400 rounded-full">
              Popular
            </span>
          )
        }
      </div>

      <p class="text-gray-600 dark:text-gray-400 text-sm mb-3">
        {feature.description}
      </p>

      <!-- Expandable Details -->
      {
        hasDetails && (
          <div class="feature-details hidden mt-4 pt-4 border-t border-gray-200 dark:border-dark-700">
            {feature.longDescription && (
              <p class="text-gray-600 dark:text-gray-400 text-sm mb-3">
                {feature.longDescription}
              </p>
            )}
            {feature.tips && feature.tips.length > 0 && (
              <div class="mt-3">
                <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">
                  Tips
                </h4>
                <ul class="space-y-1">
                  {feature.tips.map((tip) => (
                    <li class="text-gray-600 dark:text-gray-400 text-sm flex items-start gap-2">
                      <span class="text-accent-500">â€¢</span>
                      <span>{tip}</span>
                    </li>
                  ))}
                </ul>
              </div>
            )}
          </div>
        )
      }

      <!-- Footer -->
      <div class="flex items-center justify-between gap-2 mt-3">
        <span
          class="inline-flex items-center gap-1 text-xs font-medium text-gray-500 dark:text-gray-400"
        >
          <span>{category.icon}</span>
          {category.name}
        </span>

        {
          hasDetails && (
            <button
              class="expand-btn text-xs text-accent-500 hover:text-accent-600 font-medium inline-flex items-center gap-1"
              aria-expanded="false"
            >
              <span class="expand-text">Show more</span>
              <svg
                class="expand-icon w-4 h-4 transition-transform"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            </button>
          )
        }
      </div>
    </div>
  </div>
</div>

<style>
  .feature-card[data-expandable="true"] {
    cursor: pointer;
  }
  .feature-card[data-expandable="true"]:hover {
    border-color: var(--color-accent-300);
  }
  .expand-icon.rotated {
    transform: rotate(180deg);
  }
</style>

<script>
  function initFeatureCards() {
    document
      .querySelectorAll('.feature-card[data-expandable="true"]')
      .forEach((card) => {
        const details = card.querySelector(".feature-details");
        const expandBtn = card.querySelector(".expand-btn");
        const expandText = card.querySelector(".expand-text");
        const expandIcon = card.querySelector(".expand-icon");

        if (!details || !expandBtn) return;

        const toggle = () => {
          const isExpanded = !details.classList.contains("hidden");
          details.classList.toggle("hidden");
          expandBtn.setAttribute("aria-expanded", (!isExpanded).toString());
          expandIcon?.classList.toggle("rotated", !isExpanded);
          if (expandText) {
            expandText.textContent = isExpanded ? "Show more" : "Show less";
          }
        };

        // Click on card or button toggles
        card.addEventListener("click", (e) => {
          // Don't toggle if clicking an actual link
          if ((e.target as HTMLElement).tagName === "A") return;
          toggle();
        });
      });
  }

  document.addEventListener("astro:page-load", initFeatureCards);
  initFeatureCards();
</script>
