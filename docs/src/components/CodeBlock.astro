---
/**
 * Code Block with Copy Button
 * Wraps code blocks with a copy-to-clipboard button
 */
interface Props {
  code: string;
  lang?: string;
  filename?: string;
}

const { code, lang = "", filename } = Astro.props;
---

<div class="code-block-wrapper relative group">
  {
    filename && (
      <div class="code-filename px-4 py-2 bg-gray-700 dark:bg-dark-700 text-gray-300 text-sm font-mono rounded-t-lg border-b border-gray-600">
        {filename}
      </div>
    )
  }
  <div class="relative">
    <pre
      class={`language-${lang} ${filename ? "rounded-t-none" : ""}`}><code>{code}</code></pre>
    <button
      class="copy-code-btn absolute top-2 right-2 p-2 rounded-lg bg-gray-600/80 hover:bg-gray-500 text-white opacity-0 group-hover:opacity-100 transition-opacity"
      data-code={code}
      aria-label="Copy code"
      title="Copy to clipboard"
    >
      <svg
        class="copy-icon w-4 h-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
        ></path>
      </svg>
      <svg
        class="check-icon w-4 h-4 hidden text-green-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M5 13l4 4L19 7"></path>
      </svg>
    </button>
  </div>
</div>

<script>
  function initCopyButtons() {
    document.querySelectorAll(".copy-code-btn").forEach((btn) => {
      btn.addEventListener("click", async () => {
        const code = btn.getAttribute("data-code") || "";
        await navigator.clipboard.writeText(code);

        const copyIcon = btn.querySelector(".copy-icon");
        const checkIcon = btn.querySelector(".check-icon");

        copyIcon?.classList.add("hidden");
        checkIcon?.classList.remove("hidden");

        setTimeout(() => {
          copyIcon?.classList.remove("hidden");
          checkIcon?.classList.add("hidden");
        }, 2000);
      });
    });
  }

  document.addEventListener("astro:page-load", initCopyButtons);
  initCopyButtons();
</script>
