---
import BaseLayout from "../layouts/BaseLayout.astro";
import { fetchRoadmap, isGitHubConfigured } from "../data/github";

const { items, isFromGitHub } = await fetchRoadmap();

const planned = items.filter((i) => i.status === "planned");
const inProgress = items.filter((i) => i.status === "in-progress");
const done = items.filter((i) => i.status === "done");

const statusColors = {
  planned: "bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400",
  "in-progress":
    "bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400",
  done: "bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400",
};

const priorityBadges = {
  high: "bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400",
  medium:
    "bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400",
  low: "bg-gray-100 dark:bg-gray-800 text-gray-500 dark:text-gray-500",
};
---

<BaseLayout
  title="Roadmap"
  description="See what's coming next for Taj's Mod. Planned features, work in progress, and completed items."
>
  <!-- Header -->
  <section
    class="bg-gradient-to-b from-gray-100 to-gray-50 dark:from-dark-900 dark:to-dark-950 pt-12 pb-8"
  >
    <div class="container-wide text-center">
      <h1 class="text-4xl md:text-5xl font-bold mb-4">Roadmap</h1>
      <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto text-lg">
        See what's planned, what's being worked on, and what's been completed.
      </p>
      {
        !isFromGitHub && isGitHubConfigured() && (
          <p class="text-sm text-amber-600 dark:text-amber-400 mt-4">
            ‚ö†Ô∏è Using local roadmap data. GitHub API sync is configured but may
            be temporarily unavailable.
          </p>
        )
      }
      {
        !isGitHubConfigured() && (
          <p class="text-sm text-gray-500 dark:text-gray-500 mt-4">
            ‚ÑπÔ∏è Auto-sync from GitHub disabled. Showing local roadmap.
          </p>
        )
      }
    </div>
  </section>

  <!-- Roadmap Content -->
  <section class="section">
    <div class="container-wide">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- In Progress -->
        <div>
          <div class="flex items-center gap-3 mb-6">
            <div class="w-3 h-3 rounded-full bg-blue-500 animate-pulse"></div>
            <h2 class="text-xl font-bold">In Progress</h2>
            <span class="text-sm text-gray-500">({inProgress.length})</span>
          </div>
          <div class="space-y-4">
            {
              inProgress.length === 0 ? (
                <p class="text-gray-500 dark:text-gray-400 text-sm italic">
                  Nothing currently in progress
                </p>
              ) : (
                inProgress.map((item) => (
                  <div class="card">
                    <div class="flex items-start justify-between gap-2 mb-2">
                      <h3 class="font-semibold">{item.title}</h3>
                      {item.priority && (
                        <span
                          class={`px-2 py-0.5 text-xs font-medium rounded-full ${priorityBadges[item.priority]}`}
                        >
                          {item.priority}
                        </span>
                      )}
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                      {item.description}
                    </p>
                    {item.githubIssue && (
                      <a
                        href={`https://github.com/TajemnikTV/TajsMod/issues/${item.githubIssue}`}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="inline-flex items-center gap-1 text-xs text-accent-500 hover:text-accent-600 mt-3"
                      >
                        <span>#{item.githubIssue}</span>
                        <svg
                          class="w-3 h-3"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                          />
                        </svg>
                      </a>
                    )}
                  </div>
                ))
              )
            }
          </div>
        </div>

        <!-- Planned -->
        <div>
          <div class="flex items-center gap-3 mb-6">
            <div class="w-3 h-3 rounded-full bg-gray-400"></div>
            <h2 class="text-xl font-bold">Planned</h2>
            <span class="text-sm text-gray-500">({planned.length})</span>
          </div>
          <div class="space-y-4">
            {
              planned.length === 0 ? (
                <p class="text-gray-500 dark:text-gray-400 text-sm italic">
                  No planned items
                </p>
              ) : (
                planned.map((item) => (
                  <div class="card">
                    <div class="flex items-start justify-between gap-2 mb-2">
                      <h3 class="font-semibold">{item.title}</h3>
                      {item.priority && (
                        <span
                          class={`px-2 py-0.5 text-xs font-medium rounded-full ${priorityBadges[item.priority]}`}
                        >
                          {item.priority}
                        </span>
                      )}
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                      {item.description}
                    </p>
                    {item.githubIssue && (
                      <a
                        href={`https://github.com/TajemnikTV/TajsMod/issues/${item.githubIssue}`}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="inline-flex items-center gap-1 text-xs text-accent-500 hover:text-accent-600 mt-3"
                      >
                        <span>#{item.githubIssue}</span>
                        <svg
                          class="w-3 h-3"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                          />
                        </svg>
                      </a>
                    )}
                  </div>
                ))
              )
            }
          </div>
        </div>

        <!-- Done -->
        <div>
          <div class="flex items-center gap-3 mb-6">
            <div class="w-3 h-3 rounded-full bg-green-500"></div>
            <h2 class="text-xl font-bold">Done</h2>
            <span class="text-sm text-gray-500">({done.length})</span>
          </div>
          <div class="space-y-4">
            {
              done.length === 0 ? (
                <p class="text-gray-500 dark:text-gray-400 text-sm italic">
                  No completed roadmap items yet
                </p>
              ) : (
                done.map((item) => (
                  <div class="card opacity-75">
                    <div class="flex items-start justify-between gap-2 mb-2">
                      <h3 class="font-semibold line-through">{item.title}</h3>
                      <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400">
                        ‚úì
                      </span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                      {item.description}
                    </p>
                  </div>
                ))
              )
            }
          </div>
        </div>
      </div>

      <!-- Suggest Feature -->
      <div
        class="text-center mt-16 p-8 bg-gray-100 dark:bg-dark-800 rounded-2xl"
      >
        <h3 class="text-xl font-semibold mb-4">Have an idea?</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-6 max-w-md mx-auto">
          Many features on this roadmap came from community suggestions. Share
          your ideas!
        </p>
        <a
          href="https://github.com/TajemnikTV/TajsMod/issues/new"
          target="_blank"
          rel="noopener noreferrer"
          class="btn-primary inline-flex items-center gap-2"
        >
          <span>üí°</span>
          Suggest a Feature
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
